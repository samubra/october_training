<?php Block::put('breadcrumb') ?>
<ul>
    <li><a href="<?= Backend::url('samubra/training/'.$controller) ?>">培训项目</a></li>
    <li><?= e($this->pageTitle) ?></li>
</ul>
<?php Block::endPut() ?>

<?php if (!$this->fatalError): ?>
<div class="row">
    <div class="form-preview col-md-4">
        <div class="control-list">
            <h3>培训信息</h3>
            <table class="table data">
                <thead>
                <tr>
                    <th style="width: 130px"><span>名称</span></th>
                    <th><span>值</span></th>
                </tr>
                </thead>
                <tbody>
                <tr><td class="text-right">项目名称：</td><td><?php echo $formModel->title;?></td></tr>
                <tr><td class="text-right">培训时间：</td><td>
                    <?php echo $this->makePartial('plugins/samubra/training/controllers/projects/lists/start_to_end',
                    ['record'=>$formModel]) ?></td></tr>
                <tr><td class="text-right">计划考试时间：</td><td><?php echo $formModel->plan_exam_date;?></td></tr>
                <tr><td class="text-right">培训收费：</td><td><?php echo $formModel->cost;?>元/每人</td></tr>
                <tr><td class="text-right">培训方案：</td><td><a href="<?= Backend::url('samubra/training/plans/preview/'.$formModel->plan_id)?>"><?php echo $formModel->plan->title;?></a></td></tr>

                <?php if($formModel->condition){?>
                <tr>
                    <td class="text-right">复审条件：</td><td>
                    <?php foreach($formModel->condition as $condition){
                        echo '<p><span class="oc-icon-circle text-success">';
                        echo '发证日期：' . $condition['print_date_start'] . '至' . $condition['print_date_end'];
                        echo '(';
                        echo $condition['is_valid']?'已复审':'未复审';
                        echo ')';
                        echo '</span></p>';
                        }?>
                    </td>
                </tr>
                <?php }?>

                <tr><td class="text-right">创建时间：</td><td><?php echo $formModel->created_at;?></td></tr>
                <tr><td class="text-right">最后更新：</td><td><?php echo $formModel->updated_at;?></td></tr>
                <tr><td class="text-right">备注信息：</td><td><?php echo $formModel->	remark;?></td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="form-preview col-md-8">

        <div class="control-list">
            <div class="control-tabs content-tabs" data-control="tab">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#contentTabOne">申请记录</a></li>
                    <li><a href="#contentTabTwo">日程安排</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active">
                        <table class="table data">
                            <thead>
                            <tr>
                                <th><span>#</span></th>
                                <th><span>培训时间</span></th>
                                <th><span>考试成绩</span></th>
                                <th><span>受理状态</span></th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php if($formModel->records){?>
                            <?php foreach($formModel->records as $key => $record){?>
                            <tr>
                                <td><?= $key+1 ?></td>
                                <td><?php echo $record->project->training_begin_date;?> 至 <?php echo $record->project->training_end_date;?></td>
                                <td><?php echo $this->makePartial('plugins/samubra/training/controllers/records/lists/is_eligible',
                                    ['record'=>$record,'value'=>$record->is_eligible]) ?></td>
                                <td><?php echo $record->status->name;?></td>
                            </tr>
                            <?php }?>
                            <?php }else{?>
                            <tr> 没有培训记录</tr>
                            <?php }?>
                            </tbody>
                        </table>
                    </div>
                    <div class="tab-pane">
                        <table class="table data">
                            <thead>
                            <tr>
                                <th><span>#</span></th>
                                <th><span>课程名称</span></th>
                                <th><span>授课时间</span></th>
                                <th><span>学时</span></th>
                                <th><span>授课教师</span></th>
                                <th><span>授课方式</span></th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php if($formModel->courses){?>
                            <?php foreach($formModel->courses as $key => $course){?>
                            <tr>
                                <td><?= $key+1 ?></td>
                                <td><a href="<?= Backend::url('samubra/training/courses/preview/'.$course->plan_course->course_id)?>"><?php echo $course->plan_course->course->title;?></a> </td>
                                <td><?php echo $course->course_time_start;?> 至 <?php echo $course->course_time_end;?></td>
                                <td><?php echo $course->hours; ?></td>
                                <td><?php echo $course->teacher->name;?></td>
                                <td><?php echo $this->makePartial('plugins/samubra/training/controllers/plancourses/teaching_form',
                                    ['value'=>$course->plan_course->teaching_form]) ?></td>
                            </tr>
                            <?php }?>
                            <?php }else{?>
                            <tr> 没有培训记录</tr>
                            <?php }?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

    </div>
</div>
<?php else: ?>
<p class="flash-message static error"><?= e($this->fatalError) ?></p>
<?php endif ?>

<div class="form-buttons">
    <div class="loading-indicator-container">
        <a href="<?= Backend::url('samubra/training/'.$controller) ?>" class="btn btn-default oc-icon-chevron-left">
            <?= e(trans('backend::lang.form.return_to_list')) ?>
        </a>
        <a href="<?= Backend::url('samubra/training/'.$controller.'/update/'.$formModel->id) ?>" class="btn btn-primary oc-icon-pencil-left">
            修改
        </a>
        <span class="btn-text">
            <?php echo e(trans('backend::lang.form.or')) ?>
            <a href="<?php echo Backend::url('samubra/training/'.$controller) ?>">
                <?php echo e(trans('backend::lang.form.cancel')) ?>
            </a>
        </span>
    </div>
</div>
